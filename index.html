<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Dino Jump Pro</title>
    <style>
        :root { --main-green: #2ecc71; --danger-red: #e74c3c; }
        body { 
            margin: 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 100vh; background-color: #1a1a1a; font-family: -apple-system, system-ui, sans-serif; 
            color: white; overflow: hidden; touch-action: none; /* ä¸´é—¨ä¸€è„š 2ï¼šç¦ç”¨æµè§ˆå™¨é»˜è®¤æ‰‹åŠ¿ */
        }
        
        #gameContainer { position: relative; width: 95vw; max-width: 800px; aspect-ratio: 8/3; }
        canvas { 
            background-color: #fff; width: 100%; height: 100%; border-bottom: 4px solid #444; 
            border-radius: 8px; display: block; image-rendering: pixelated;
        }
        
        /* UI å åŠ å±‚ */
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            background: rgba(0,0,0,0.6); border-radius: 8px; z-index: 10;
        }
        #startBtn { 
            padding: 12px 35px; font-size: 20px; font-weight: bold; color: white; 
            background: var(--main-green); border: none; border-radius: 50px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); -webkit-tap-highlight-color: transparent;
        }

        /* åˆ†æ•°æ˜¾ç¤º */
        .score-board { text-align: center; margin-bottom: 10px; width: 100%; }
        #scoreDisplay { font-size: 32px; margin: 0; color: var(--main-green); font-weight: 800; }
        #highScore { font-size: 14px; color: #888; margin: 0; }

        .controls { margin-top: 15px; display: flex; gap: 10px; }
        .upload-btn { background: #333; color: #ccc; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 13px; border: 1px solid #444; }
        #fileInput { display: none; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="score-board">
    <p id="highScore">æœ€é«˜åˆ†: 0</p>
    <h1 id="scoreDisplay">0</h1>
</div>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    
    <div id="uiOverlay" class="overlay">
        <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
        <p style="font-size: 12px; margin-top: 10px; color: #aaa;">ç‚¹å‡»ç”»é¢æˆ–æŒ‰ç©ºæ ¼è·³è·ƒ (æ”¯æŒäºŒæ®µè·³)</p>
    </div>
</div>

<div class="controls">
    <label for="fileInput" class="upload-btn">ğŸ“· æ›´æ¢è§’è‰²å›¾ç‰‡</label>
    <input type="file" id="fileInput" accept="image/*">
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const highScoreDisplay = document.getElementById('highScore');
    const uiOverlay = document.getElementById('uiOverlay');
    const startBtn = document.getElementById('startBtn');
    const fileInput = document.getElementById('fileInput');

    // é€»è¾‘åˆ†è¾¨ç‡ä¿æŒ 800x300ï¼ŒCSS ä¼šè‡ªåŠ¨ä¼¸ç¼©é€‚é…æ‰‹æœºå±å¹•
    canvas.width = 800;
    canvas.height = 300;

    // --- èµ„æºç®¡ç† ---
    let dinoImg = new Image();
    dinoImg.src = 'dino.png'; 
    let highScore = localStorage.getItem('dinoHighScore') || 0;
    highScoreDisplay.innerText = `æœ€é«˜åˆ†: ${Math.floor(highScore)}`;

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => { dinoImg.src = event.target.result; };
            reader.readAsDataURL(file);
        }
    });

    // --- æ¸¸æˆçŠ¶æ€ ---
    let score = 0, gameSpeed = 6, gameState = 'WAITING', frame = 0;
    const obstacles = [];
    const dino = {
        x: 80, y: 200, width: 55, height: 55,
        dy: 0, jumpForce: 13, gravity: 0.8,
        jumpCount: 0, maxJumps: 2
    };

    // --- æ ¸å¿ƒé€»è¾‘ ---

    function startGame() {
        score = 0; gameSpeed = 6; obstacles.length = 0;
        dino.y = 200; dino.dy = 0; dino.jumpCount = 0; frame = 0;
        gameState = 'PLAYING';
        uiOverlay.classList.add('hidden');
        requestAnimationFrame(gameLoop);
    }

    // é€‚é…æ‰‹æœºç‚¹å‡»ä¸é”®ç›˜
    startBtn.addEventListener('click', (e) => { e.stopPropagation(); startGame(); });
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault();
            if (gameState === 'PLAYING') jump();
            else if (gameState !== 'PLAYING') startGame();
        }
    });

    // æ‰‹æœºè§¦æ‘¸äº‹ä»¶ä¼˜åŒ–
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault(); // é˜²æ­¢åŒå‡»ç¼©æ”¾
        if (gameState === 'PLAYING') jump();
    }, { passive: false });

    function jump() {
        if (dino.jumpCount < dino.maxJumps) {
            dino.dy = -dino.jumpForce;
            dino.jumpCount++;
        }
    }

    function update() {
        frame++;
        score += 0.15;
        scoreDisplay.innerText = Math.floor(score);
        gameSpeed += 0.0015;

        dino.dy += dino.gravity;
        dino.y += dino.dy;

        if (dino.y + dino.height > canvas.height) {
            dino.y = canvas.height - dino.height;
            dino.dy = 0;
            dino.jumpCount = 0;
        }

        // éšœç¢ç‰©ç”Ÿæˆé€»è¾‘ (éšéš¾åº¦å˜å¿«)
        if (frame % Math.max(35, Math.floor(100 - gameSpeed * 2.5)) === 0) {
            const h = 40 + Math.random() * 65;
            obstacles.push({ x: canvas.width, y: canvas